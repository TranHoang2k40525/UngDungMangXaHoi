<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang quản trị - Ứng dụng mạng xã hội</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="logo">
                    <h1>Admin Panel</h1>
                </div>
                <nav class="nav">
                    <a href="auth/login.html" id="loginLink" class="nav-link">Đăng nhập</a>
                    <div id="adminMenu" class="admin-menu" style="display: none;">
                        <span id="adminName">Tên admin</span>
                        <button id="logoutBtn" class="btn btn-outline">Đăng xuất</button>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <div class="container">
                <div id="welcomeMessage" class="welcome-message">
                    <h2>Chào mừng đến với Admin Panel!</h2>
                    <p>Quản lý và giám sát ứng dụng mạng xã hội.</p>
                </div>

                <div id="adminContent" class="admin-content" style="display: none;">
                    <h2>Xin chào, <span id="adminDisplayName"></span>!</h2>
                    <p>Bạn đã đăng nhập với quyền quản trị viên.</p>
                    
                    <div class="admin-dashboard">
                        <div class="dashboard-grid">
                            <div class="dashboard-card">
                                <h3>Quản lý người dùng</h3>
                                <p>Xem và quản lý tất cả người dùng</p>
                                <button class="btn btn-primary" onclick="goToUsers()">Xem người dùng</button>
                            </div>
                            
                            <div class="dashboard-card">
                                <h3>Báo cáo</h3>
                                <p>Xem các báo cáo và khiếu nại</p>
                                <button class="btn btn-primary" onclick="goToReports()">Xem báo cáo</button>
                            </div>
                            
                            <div class="dashboard-card">
                                <h3>Kiểm duyệt</h3>
                                <p>Kiểm duyệt nội dung</p>
                                <button class="btn btn-primary" onclick="goToModeration()">Kiểm duyệt</button>
                            </div>
                            
                            <div class="dashboard-card">
                                <h3>Cài đặt</h3>
                                <p>Cài đặt hệ thống</p>
                                <button class="btn btn-primary" onclick="goToSettings()">Cài đặt</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 SocialApp Admin. Tất cả quyền được bảo lưu.</p>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="Context/AdminContext.js"></script>
    <script>
        // Khởi tạo AdminContext
        const adminContext = window.AdminContext;

        // Cập nhật UI dựa trên trạng thái đăng nhập
        function updateUI() {
            const loginLink = document.getElementById('loginLink');
            const adminMenu = document.getElementById('adminMenu');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const adminContent = document.getElementById('adminContent');
            const adminName = document.getElementById('adminName');
            const adminDisplayName = document.getElementById('adminDisplayName');

            if (adminContext.isAuthenticated && adminContext.admin) {
                // Đã đăng nhập
                loginLink.style.display = 'none';
                adminMenu.style.display = 'flex';
                welcomeMessage.style.display = 'none';
                adminContent.style.display = 'block';
                
                adminName.textContent = adminContext.admin.email;
                adminDisplayName.textContent = adminContext.admin.email;
            } else {
                // Chưa đăng nhập
                loginLink.style.display = 'block';
                adminMenu.style.display = 'none';
                welcomeMessage.style.display = 'block';
                adminContent.style.display = 'none';
            }
        }

        // Xử lý đăng xuất
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await adminContext.logout();
                updateUI();
                alert('Đăng xuất thành công!');
            } catch (error) {
                console.error('Logout error:', error);
                alert('Có lỗi xảy ra khi đăng xuất.');
            }
        });

        // Lắng nghe thay đổi trạng thái đăng nhập
        adminContext.addListener(updateUI);

        // Khởi tạo UI
        updateUI();

        // Các hàm điều hướng
        function goToUsers() {
            window.location.href = 'users/users.html';
        }

        function goToReports() {
            window.location.href = 'reports/reports.html';
        }

        function goToModeration() {
            window.location.href = 'moderation/moderation.html';
        }

        function goToSettings() {
            window.location.href = 'settings/settings.html';
        }

        // Setup auto refresh token
        adminContext.setupTokenRefresh();
    </script>
</body>
</html>
