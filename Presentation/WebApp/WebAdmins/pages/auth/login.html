<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÄÄƒng nháº­p - Admin</title>
  <link rel="stylesheet" href="../../styles.css">
</head>
<body>
  <div class="container-center">
    <div class="card auth">
      <a class="back-arrow" href="../index.html" title="Quay láº¡i">â†</a>

      <div class="logo">ADMIN PANEL</div>

      <form id="loginForm">
        <input name="identifier" id="identifier" class="form-control" placeholder="Email hoáº·c Sá»‘ Ä‘iá»‡n thoáº¡i" required />
        <div style="position:relative">
          <input id="pwd" type="password" name="password" class="form-control" placeholder="Máº­t kháº©u" required />
          <button type="button" onclick="(function(){ const p=document.getElementById('pwd'); p.type = p.type==='password'?'text':'password'; })()" style="position:absolute;right:12px;top:8px;border:none;background:none;color:#9ca3af;">ğŸ‘ï¸</button>
        </div>

        <div class="auth-btn-wrap">
          <button class="btn-primary" type="submit" id="loginBtn" style="width:320px;max-width:86%;">ÄÄƒng nháº­p</button>
        </div>

        <div class="auth-links">
          <div>ChÆ°a cÃ³ tÃ i khoáº£n? <a href="register.html">ÄÄƒng kÃ½</a></div>
          <div style="margin-top:8px"><a href="forgot-password.html">QuÃªn máº­t kháº©u?</a></div>
        </div>

        <div id="msg" style="min-height:18px;margin-top:12px;color:var(--muted)"></div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../Context/AdminContext.js"></script>
  <script>
    const adminContext = window.AdminContext;
    
    // Kiá»ƒm tra tráº¡ng thÃ¡i Ä‘Äƒng nháº­p khi load trang
    window.addEventListener('load', () => {
      if (adminContext.isAuthenticated) {
        window.location.href = '../index.html';
      }
    });
    
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const loginBtn = document.getElementById('loginBtn');
      const msg = document.getElementById('msg');
      const originalText = loginBtn.textContent;
      
      try {
        loginBtn.textContent = 'Äang Ä‘Äƒng nháº­p...';
        loginBtn.disabled = true;
        msg.textContent = '';
        
        const identifier = document.getElementById('identifier').value;
        const password = document.getElementById('pwd').value;
        
        // XÃ¡c Ä‘á»‹nh email hoáº·c phone
        const credentials = {
          Email: identifier.includes('@') ? identifier : '',
          Phone: !identifier.includes('@') ? identifier : '',
          Password: password
        };
        
        // Gá»i API Ä‘Äƒng nháº­p
        const result = await adminContext.login(credentials);
        
        if (result.success) {
          msg.textContent = 'ÄÄƒng nháº­p thÃ nh cÃ´ng!';
          msg.style.color = 'green';
          setTimeout(() => {
            window.location.href = '../index.html';
          }, 1000);
        } else {
          msg.textContent = 'Lá»—i: ' + result.error;
          msg.style.color = 'red';
        }
      } catch (error) {
        msg.textContent = 'Lá»—i: ' + error.message;
        msg.style.color = 'red';
      } finally {
        loginBtn.textContent = originalText;
        loginBtn.disabled = false;
      }
    });
  </script>
</body>
</html>